---
layout: post
title: "OO-Unit1"
date:   2024-12-03
tags: [OO]
comments: true
author: BUAA-Yzx2023
---

<!-- more -->

å…ˆè¯´ä¸‹ç»“æœï¼Œexamå¾ˆç®€å•é¡ºåˆ©é€šè¿‡ï¼Œextraé–æˆ˜100minå¾—äº†25åˆ†ã€‚ï¼ˆæœ€åå‰²é¡»å¼ƒè¢ï¼Œè½è’è€Œé€ƒï¼Œè¿˜æŠŠæ°´æ¯è½åœ¨äº†æœºæˆ¿

è¿™æ˜¯ä¸€åœº æŠ«ç€OSå¤–è¡£çš„ ç¨‹è®¾ C8 ä¸Šæœºï¼Œè€ƒå¯Ÿçš„å…¨æ˜¯æŒ‡é’ˆã€‚é¢˜å‹å’Œ 2023 å¹´çš„å®Œå…¨ä¸€è‡´ï¼Œå¯å‚è€ƒä»¥ä¸‹ä¸¤ä½å­¦é•¿çš„åšå®¢ï¼š

[buaa nr](https://www.cnblogs.com/juantify/p/17238949.html)

[cookedbear](https://cookedbear.top/p/44391.html)



## exam

***é¢˜é¢***

å®ç°ä¸€ä¸ªè‡ªå®šä¹‰æ ¼å¼åŒ–å­—ç¬¦ä¸² `%[flags][width][length]k`ï¼ŒåŠŸèƒ½æ˜¯è¾“å‡ºä¸€ä¸ªé”®å€¼å¯¹ `<key> => <value>`

 - `<key>`ã€`=>`ã€`<value>`ä¹‹é—´å›ºå®šè¦æœ‰ä¸€ä¸ªç©ºæ ¼
 - `<key>` æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ ¼å¼éµä» `[flags]` å’Œ `[width]]` 
 - `<value>` æ˜¯ `int` æˆ– `long int` ç±»å‹ï¼Œæ ¼å¼éµä» `[flags]` å’Œ `[width]]` 

***æ ·ä¾‹è¾“å…¥***

```c
printk("%k","num",123);
```

***æ ·ä¾‹è¾“å‡º***

```c
num => 123
```



æŒºç®€å•çš„ï¼Œå¤åˆ¶ `%...d`ã€`%...s`ã€`%...c` çš„å®ç°å³å¯

***æˆ‘çš„ä»£ç ***

```c
case 'k':
			s = (char *)va_arg(ap, char *);
			print_str(out, data, s, width, ladjust);

			c = ' ';
			print_char(out, data, c, 1, ladjust);
			c = '=';
			print_char(out, data, c, 1, ladjust);
			c = '>';
			print_char(out, data, c, 1, ladjust);
			c = ' ';
			print_char(out, data, c, 1, ladjust);

			if (long_flag)
			{
				num = va_arg(ap, long int);
			}
			else
			{
				num = va_arg(ap, int);
			}

			if (num < 0)
			{
				num = -num;
				neg_flag = 1;
			}
			print_num(out, data, num, 10, neg_flag, width, ladjust, padc, 0);

			break;

```



## extra

å…¶å®è¿™ä¸ªä¹Ÿä¸éš¾ï¼Œå°±æ˜¯å®ç°ä¸€ä¸ª ç±»ä¼¼ `sprintf` çš„å‡½æ•°ï¼Œä¸¤ä½å­¦é•¿çš„åšå®¢éƒ½å·²æåˆ°è¿‡ã€‚ä½†æ˜¯æŒ‡é’ˆé›ªè—å¤šå¹´å®åœ¨ç”Ÿç–ï¼Œå¯¼è‡´å‡ºç°äº†æ¼«å±±éé‡çš„ `Bug`ã€‚

***é¢˜é¢***

å®ç°ä¸€ä¸ªç®€å•çš„å†…å­˜æ–‡ä»¶æµï¼ˆ`fmemopen`ã€`fmemprintf`ã€`fseek`ã€`fclose`ï¼‰ï¼Œç±»ä¼¼äºæ ‡å‡†åº“çš„ `FILE*` æ“ä½œï¼Œä½†é’ˆå¯¹å†…å­˜ç¼“å†²åŒº

- é¦–å…ˆæ˜¯æˆ‘ä»¬çš„ FILE ç»“æ„ä½“ç±»å‹

  ```c
  typedef struct{
  	char *ptr;			// å†™æŒ‡é’ˆ
  	char *base;			// åŸºæŒ‡é’ˆ
  	char *end;			// å°¾æŒ‡é’ˆ
  }FILE;
  ```

- å®ç°å‡½æ•° `FILE *fmemopen(FILE *stream, void *buf, const char *mode)`;

  - åŠŸèƒ½ï¼šæ ¹æ®æ‰“å¼€æ–¹å¼ `mode`ï¼Œåˆå§‹åŒ–å†…å­˜æµ `FILE *stream`
  - è‹¥ `mode` ä¸º `"w"` ï¼Œåˆ™ä¸ºè¦†ç›–å¼å†™å…¥ã€‚ä»¤ `stream` çš„å†™æŒ‡é’ˆã€åŸºæŒ‡é’ˆã€å°¾æŒ‡é’ˆéƒ½æŒ‡å‘ `buf`ã€‚è¿”å›å‚æ•° `stream`
  - è‹¥ `mode` ä¸º `"a"` ï¼Œåˆ™ä¸ºè¿½åŠ å¼å†™å…¥ã€‚ä»¤ `stream` çš„å†™æŒ‡é’ˆæŒ‡å‘ `buf`ä¸­ç¬¬ä¸€ä¸ª`'\0'`ï¼ŒåŸºæŒ‡é’ˆã€å°¾æŒ‡é’ˆéƒ½æŒ‡å‘ `buf`ã€‚è¿”å›å‚æ•° `stream`
  - è‹¥ `mode` ä¸ä¸ºä»¥ä¸ŠäºŒè€…ï¼Œåˆ™è¿”å› `NULL`

- å®ç°å‡½æ•° `int fmemprintf(FILE *stream, const char *fmt, ...);`

  - åŠŸèƒ½ï¼šå°†æ ¼å¼åŒ–å­—ç¬¦ä¸²å†™å…¥å†…å­˜æµ `FILE *stream`ï¼Œå¹¶ **è¿”å›å†™å…¥çš„å­—ç¬¦æ•°**

  - æç¤ºï¼šä»¿ç…§ `printk` å‡½æ•°å®ç°ï¼Œå¯ä»¥è°ƒç”¨ä½ è¯¾ä¸‹å®Œæˆçš„ `vprintfmt` å‡½æ•°ã€‚

    `void vprintfmt(fmt_callback_t out, void *data, const char *fmt, va_list ap)` çš„å‰ä¸¤ä¸ªå‚æ•°è¢«ç§°ä¸º å›è°ƒå‡½æ•°ã€å›è°ƒä¸Šä¸‹æ–‡ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯é€šè¿‡è°ƒç”¨ `out` å‡½æ•°ï¼Œå°†æ ¼å¼åŒ–å­—ç¬¦ä¸²è¾“å‡ºåˆ° `data` ä¸­ã€‚è€Œè¯¾ä¸‹ä½œä¸šæ˜¯è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œå›è°ƒå‡½æ•° `outputk` å¹¶æ²¡æœ‰ç”¨åˆ° `data`ï¼Œæ•… `data` æ²¡æœ‰èµ·åˆ°ä½œç”¨ã€‚

    å¯¹äºè¦æ±‚å®ç°çš„ `fmemprintf` å‡½æ•°ï¼Œä½ å¯ä»¥ä¼ å…¥å†…å­˜æµ `stream` ä½œä¸º `data`ï¼Œå¹¶ä¸”ä»¿ç…§ `outputk` å†™å‡ºåˆé€‚çš„å›è°ƒå‡½æ•°

- å®ç°å‡½æ•° `int fseek(FILE *stream, long offset, int fromwhere);`
  - åŠŸèƒ½ï¼šå°†å†™æŒ‡é’ˆæŒªåˆ°æŒ‡å®šä½ç½®
  - è‹¥ `fromwhere` ä¸º `SEEK_SET`ï¼ˆå®ï¼‰ï¼Œåˆ™å†™æŒ‡é’ˆæŒ‡å‘ `stream->base + offset` 
  - è‹¥ `fromwhere` ä¸º `SEEK_CUR`ï¼ˆå®ï¼‰ï¼Œåˆ™å†™æŒ‡é’ˆæŒ‡å‘ `stream->ptr + offset` 
  - è‹¥ `fromwhere` ä¸º `SEEK_END`ï¼ˆå®ï¼‰ï¼Œåˆ™å†™æŒ‡é’ˆæŒ‡å‘ `stream->end + offset` 
  - è‹¥ `fromwhere` ä¸ºä»¥ä¸Šä¸‰ç§å–å€¼ï¼Œä¸”æŒªåŠ¨åçš„å†™æŒ‡é’ˆä½äºé—­åŒºé—´`[ base , end ]`ä¸­ï¼Œåˆ™è¿”å› 0ï¼›å¦åˆ™è¿”å› -1
- å®ç°å‡½æ•° `int fclose(FILE *stream)`
  - å…³é—­å†…å­˜æµ
  - å°†å°¾æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹ç½®ä¸º `'\0'`



æä¾›å¾…è¡¥å…¨çš„`string.c`ï¼Œå…¶ä¸­å·²å®ç° `memcpy`ã€`memset`ã€`strcpy`ã€`strlen`ã€`strchr`ã€`strcmp` å‡½æ•°ã€‚

é¦–å…ˆä½ éœ€è¦å¼•å…¥æ‰€éœ€çš„å¤´æ–‡ä»¶ï¼š

```c
#include <print.h>
#include <stream.h>
```

ç„¶ååœ¨ `string.c` æœ«å°¾å®ç°ä¸Šè¿°4ä¸ªå‡½æ•°



***æ ·ä¾‹è¾“å…¥***

```markdown
æš‚æ— 
```

***æ ·ä¾‹è¾“å‡º***

```
æš‚æ— 
```

***æˆ‘çš„ä»£ç ***

```c
FILE *fmemopen(FILE *stream, void *buf, const char *mode){
	if(strcmp(mode,"w")==0){
		stream->ptr = (char*)buf;
		stream->base = (char*)buf;
		stream->base = (char*)buf;	
	}
	else if (strcmp(mode,"a")==0){
		stream->base = (char*)buf;
		char  *s = (char*)strchr(buf,'\0');
		stream->ptr = s;
		stream->end = s;
	}
	else{
		return NULL;
	}
	return stream;
}

void outputfile(FILE *data,const char *buf,size_t len){
    
         char *s = data->ptr;
         for(int i = 0; i<len ; i++){
                 *s = buf[i];
                 s++;
         }
         data->ptr = s;
         data->end = s;
 }

int fmemprintf(FILE *stream, const char *fmt, ...){
	char *ptr1 = stream->ptr;
	va_list ap;
	va_start(ap,fmt);
	vprintfmt(outputfile,stream,fmt,ap);
	va_end(ap);		
	char *ptr2 = stream->ptr;
	int len = ptr2-ptr1;
	return len;
}

int fseek(FILE *stream, long offset, int fromwhere){
	char *s = stream->ptr;
	char *base = stream->base;
	char *end = stream->end; 
	s = s + (fromwhere + offset);
	
	if ((s-base > 0)&&(end-s > 0)){
		stream->ptr = s;
		return 0;

	}
	else{
		return -1;
	}

}

int fclose(FILE *stream){
	char *end = stream->end;
	*end = '\0';
	return 0;
}
```



***Bugåˆ†æ***

- `void*`ã€`char*`ã€`const char* `è¿™å‡ ç§æŒ‡é’ˆè¦ **å¼ºåˆ¶è½¬æ¢**ï¼Œå¦åˆ™ä¼šç¼–è¯‘é”™è¯¯

- æ³¨æ„ `fmemopen` ä¸­ï¼Œåˆ¤æ–­ `mode` æ—¶**ä¸èƒ½ åªè§£å¼•ç”¨æ¥åˆ¤æ–­ç¬¬ä¸€ä¸ªå­—ç¬¦**





### å¿ƒå¾—ä½“ä¼š

èœå°±å¤šç»ƒğŸ˜­



